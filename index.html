<!DOCTYPE html> <meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"
/>
<script
  nomodule
  src="/node_modules/@babel/polyfill/dist/polyfill.min.js"
></script>
<script>
  // window.ShadyDOM = { force: true };
</script>
<script src="https://unpkg.com/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>

<script type="module" src="/auto-pass-element.js"></script>
<auto-pass id="autoPass"></auto-pass>

<div id="shady"></div>

<script type="module">
  import { storePassword } from "/auto-pass.js";
  shady.attachShadow({ mode: "open" });
  shady.shadowRoot.innerHTML = `
    <form id="form" method="post" action="/success">
      <input id="myUsernameInput">
      <input id="myPasswordInput" type="password">
      <button type="submit" id="submit">Log in</button>
    </form>`;
  autoPass.connectUsernameInput(
    shady.shadowRoot.getElementById("myUsernameInput")
  );
  autoPass.connectPasswordInput(
    shady.shadowRoot.getElementById("myPasswordInput")
  );

  // shady.shadowRoot.getElementById("form").addEventListener("submit", e => {
  //   const redirect = () => {
  //     window.location.href = "/loggedin";
  //     history.pushState(null, null, "/loggedin");
  //   };
  //   storePassword();
  //   fetch("/login", {
  //     method: "POST",
  //     body: new FormData(shady.shadowRoot.getElementById("form"))
  //   }).then(redirect, console.log);
  //   e.preventDefault();
  // });
</script>

<span id="browser-sync-binding"></span>
